<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Thomas Lehmann <thomas.lehmann.private@gmail.com">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Use of the library without Jenkins - jenkins-shared-library</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Use of the library without Jenkins";
    var mkdocs_page_input_path = "xlocal.md";
    var mkdocs_page_url = "/jenkins-shared-library/xlocal/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> jenkins-shared-library</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../documentation/">How to organize Documenation</a>
                </li>
                <li class="">
                    
    <a class="" href="../gradle/">How to organize Gradle</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">DSL</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../virtualenv/">Python virtual environments</a>
                </li>
                <li class="">
                    
    <a class="" href="../xgradle/">Own Gradle DSL</a>
                </li>
                <li class="">
                    
    <a class="" href="../jobdslcode/">Job DSL code support</a>
                </li>
                <li class="">
                    
    <a class="" href="../xgit/">Git DSL</a>
                </li>
                <li class="">
                    
    <a class="" href="../xpublish/">The publisher</a>
                </li>
                <li class="">
                    
    <a class="" href="../xfind/">Find DSL</a>
                </li>
                <li class="">
                    
    <a class="" href="../xdup/">Duplicate Code Finder</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Use of the library without Jenkins</a>
    <ul class="subnav">
            
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">jenkins-shared-library</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>DSL &raquo;</li>
        
      
    
    <li>Use of the library without Jenkins</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Nachtfeuer/jenkins-shared-library/edit/master/docs/xlocal.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="use-of-the-library-without-jenkins">Use of the library without Jenkins</h1>
<div class="toc">
<ul>
<li><a href="#use-of-the-library-without-jenkins">Use of the library without Jenkins</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#simple-scenario">Simple scenario</a></li>
<li><a href="#using-the-fat-jar-as-tool">Using the fat jar as tool</a></li>
<li><a href="#supported-dsl-functions">Supported DSL functions</a></li>
<li><a href="#is-vars-dead-code">Is vars dead code?</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="introduction">Introduction</h2>
<p>Writing Jenkins DSL code usually also means to write unittests and
to mock things because you don't have the Jenkins and its
plugins as part of your build process (and you also should not have it).</p>
<p>However there are usecases where it would be awesome when you were
able to use your own library code locally (still: without Jenkins):</p>
<ul>
<li>testing your library code that it does work as expected (without mocks).</li>
<li>using your library as a tool to run a Jenkinsfile without Jenkins.</li>
</ul>
<p>The first use case is more simple since you - usually - don't require too
many DSL functions that have to be implemented before you can test one or
two of your classes. For the second use case you require quite some DSL
because you have to implement all DSL you see in a Jenkinsfile and the
few DSL functions used in the classes. Giving you an idea see next section ...</p>
<h2 id="simple-scenario">Simple scenario</h2>
<p>Consider the duplicate code DSL and the related classes in this library.
That library code does required <strong>sh</strong>, <strong>readFile</strong> and <strong>writeFile</strong> as DSL functions.
The class <code>my.dsl.Jenkinks</code> does implement all this DSL functions for local use
while the class <code>my.dsl.ScriptExecutor</code> is capable of running any Groovy code:</p>
<pre><code class="groovy">import my.dsl.Jenkins
import my.dsl.ScriptExecutor

def executor = new ScriptExecutor(Jenkins)
executor.execute('''
    import my.tools.DuplicateCodeFinder
    import my.tools.Find

    def sourceFiles = new Find(this).files('src', '*.groovy')
    sourceFiles.addAll(new Find(this).files('test', '*.groovy'))

    def dup = new DuplicateCodeFinder(this)
    dup.minimumBlockSize = 8
    dup.sourceFiles = sourceFiles
    dup.check()
''')
println('done')
</code></pre>

<p>Being in the root of this project call it like following:</p>
<pre><code class="bash">groovy -cp src examples/xdup.groovy
</code></pre>

<p>It works really good. Even the <code>my.dsl.*</code> code can be easily unittested.
At the end you just need one <em>all in one</em> jar being executable to
pass a script file as parameter which works similar to the example above.</p>
<h2 id="using-the-fat-jar-as-tool">Using the fat jar as tool</h2>
<pre><code class="bash">$ java -jar build/libs/jenkins-shared-pipeline-all-1.0.jar --help
usage: java -jar jenkins-shared-pipeline.jar [options]
Options:
 -h,--help            Print this help text and exit.
 -s,--script &lt;file&gt;   Groovy script file
</code></pre>

<p>If you put the code passed to the <code>ScriptExecutor</code> in last example into a file
you can do following</p>
<pre><code class="bash">$ java -jar build/libs/jenkins-shared-pipeline-all-1.0.jar --script /tmp/xdup.groovy
</code></pre>

<h2 id="supported-dsl-functions">Supported DSL functions</h2>
<p>It will constantly be extended but for now
following DSL functions are implemented:</p>
<table>
<thead>
<tr>
<th>Commands:</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>echo</td>
<td>sh</td>
<td>writeFile</td>
<td>readFile</td>
</tr>
<tr>
<td>withEnv</td>
<td>stage</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="is-vars-dead-code">Is vars dead code?</h2>
<p>At least I have not found a way (yet) how to use it without Jenkins.
The <strong>ScriptExecutor</strong> expects an abstract class that implements those DSL
code for injecting it into a <code>GroovyShell</code> instance. The mechanism basically
comes from Groovy itself. Compiling the sources in <em>vars</em> (which is possible)
I need to find a way how those scripts know the DSL they use. Because of this
and the problem that the code cannot easily be tested (yet) you should keep the
code of your own DSL functions very vey small delegating to a class based
implementation using dependency injection under <code>src/**</code>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../xdup/" class="btn btn-neutral" title="Duplicate Code Finder"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Nachtfeuer/jenkins-shared-library/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../xdup/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
